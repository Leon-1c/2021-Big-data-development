#### 1.功能简介
本文件同步器能根据用户指定的模式（local和bucket）对本地文件夹以及云端桶存储的文件同步。用户只需在windows资源管理器或者s3浏览器直接对两边的文件内容进行操作，需要同步的时候运行程序并选择同步模式即可。本同步器支持用户对多级文件夹以及里面的内容进行同步，同步后两边的文件以及目录结构保持一致。

#### 2.代码函数解析
```md5sum(path)```
输入以本地同步文件夹为根目录的文件地址，返回本地文件的md5值，对于小于20M的小文件，使用普通的md5计算方法；对于分片上传到云端的大文件，使用与s3在云端计算ETag的特殊算法。  
  
```gci(nlist,path)```
递归遍历在path下的所有文件，包括子文件夹，返回一个文件名list，存放在nlist。  
  
```connect()```
创建s3的client连接。  
  
```get_bucket_filename(s3_client)```
获取桶内所有文件名（不包含文件夹），以列表的形式返回这些文件的信息，其中包括文件名```key```，文件```ETag```，文件最后修改时间```lastmodifytime```。  
  
```get_local_filename```
获取本地文件夹下所有文件名（不包含文件夹），以列表的形式返回这些文件的信息，其中包括文件名```key```，文件```ETag```，文件最后修改时间```lastmodifytime```。  
  
```upload(s3_client, filename)```
上传文件，如果文件大于20M，则使用分片上传，否则直接上传。在进行分片上传时，先检查文件是否有已上传的分段，如果有则直接跳过已上传部分，进行剩余部分上传。  
  
```download(s3_client, key)```
下载文件，如果文件大于20M，则使用分段下载，否则直接下载。在进行分段下载时，先检查文件在本地是否有缓存，如果有则继续下载剩余部分。  
  
```comp(local_list, bucket_list, key)```
对本地和云端的文件进行对比，先比较md5值，若一致则返回0；若不一致，云端较新返回-1，本地较新返回1。  
  
```synchronize(s3_client, mod)```
根据模式进行文件同步，local模式以本地文件夹为基础，同步到云端；bucket模式以云端文件为基础，同步到本地。  
  
```lambda```
负责给云端文件增加一个meta数据```lastmodifytime```最后修改时间，目的是与本地文件进行比较。  
  
#### 3.具体实现
##### 上传文件
当上传的文件名包含目录结构时，首先判断桶内是否已创建相对应的文件夹，若没有则提前创建一个空文件夹。上传模式根据文件大小来确定，小于给定阈值20M，则直接上传；大于20M，则先判断是否已有上传的分片，若已有上传分片则继续上传剩余的，若没有则从零上传。
##### 下载文件
当下载的文件名包含目录结构时，首先判断本地是否已有相对应的文件夹，若没有则提前创建一个空文件夹。下载模式根据文件大小来确定，小于给定阈值20M，则直接下载；大于20M，则先判断是否已有下载的分段，若有则继续下载剩余分段，若没有则从零开始下载。
##### lambda函数
每当云端桶使用 ```put``` ```post``` ```CompleteMultipartUpload``` 等方法时，都通过```copy_object```函数从原来的位置复制一个一样的对象，并添加一个metadata数据，格式为：```{'Lastmodifytime' : 'CurrentTime'}```，目的是为每个对象添加最后修改时间，并以此作为参考与本地文件比较。
##### 同步模式
不同的同步模式都会遇到两种不同的情况：
- 文件名相同，同步判断：
首先根据文件的md5值判断云端与本地的文件是否属于同一文件，若md5值一致，表示这两个文件一致，则进行下一个文件的判断，若不一致，则根据最后修改时间进行判断，以最新的文件作为基准进行上传/下载。  
- 文件名不同，模式判断：
根据初始选择的模式来判断，若选择local模式，则本地有而云端没有的文件要上传，本地没有而云端有的文件要删除；若选择bucket模式则相反。  
##### 本地文件ETag计算
由于分块上传的文件ETag值与直接上传的文件ETag值计算方法不同，因此本地计算方法也要相应的修改。对于使用分块上传的文件（大于20M），在计算md5值时采用与s3在云端计算分块上传文件一致的算法，即可保证在同步时的准确性





